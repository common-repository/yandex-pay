"use strict";function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}jQuery(document).ready(function(e){new class{constructor(){_defineProperty(this,"sdkLoaded",!1),_defineProperty(this,"buttonContanier",void 0),_defineProperty(this,"button",void 0);let e=this;jQuery("body").on("updated_checkout",function(){e.refreshButton()}),jQuery(document).on("payment_method_selected",function(){e.refreshButton()})}loadSdk(){var t=this;return new Promise(function(a,o){if(e("#yandex-pay").length)t.sdkLoaded=!0,a();else{var n=document.createElement("script");n.type="text/javascript",n.src="https://pay.yandex.ru/sdk/v1/pay.js",n.setAttribute("id","yandex-pay"),n.setAttribute("onload","wooYandexPayLoadedSkd()"),n.setAttribute("async",!0),document.body.appendChild(n),window.wooYandexPayLoadedSkd=function(){t.sdkLoaded=!0,a()}}})}createButton(){var t=this;let a={};a.env="1"===t.getParam("test_mode")?YaPay.PaymentEnv.Sandbox:YaPay.PaymentEnv.Production,a.version=2,a.countryCode=YaPay.CountryCode.Ru,a.currencyCode=YaPay.CurrencyCode.Rub,a.merchant={id:t.getParam("merchant_id"),name:t.getParam("merchant_name")},a.order=t.getParam("order"),a.paymentMethods=[{type:YaPay.PaymentMethodType.Card,gateway:t.getParam("gateway"),gatewayMerchantId:t.getParam("gateway_merchant_id"),allowedAuthMethods:[YaPay.AllowedAuthMethod.PanOnly],allowedCardNetworks:[YaPay.AllowedCardNetwork.Visa,YaPay.AllowedCardNetwork.Mastercard,YaPay.AllowedCardNetwork.Mir,YaPay.AllowedCardNetwork.Maestro,YaPay.AllowedCardNetwork.VisaElectron]}],YaPay.createPayment(a,{agent:{name:"CMS-WooCommerce",version:"1.0"}}).then(function(a){e("#woo-yandex-pay-payment-data").remove(),e("#woo-yandex-pay-order-id").remove();var o=e("form.checkout");o.append('<input type="hidden" id="woo-yandex-pay-payment-data" name="woo_yandex_pay_payment_data" value="">'),o.append('<input type="hidden" id="woo-yandex-pay-order-id" name="woo_yandex_pay_order_id" value="">'),e("#place_order").hide(),e("#woo-yandex-pay-button-contanier").length?e("#woo-yandex-pay-button-contanier").html(""):e("#place_order").after(e("<div>").attr("id","woo-yandex-pay-button-contanier"));var n=YaPay.ButtonTheme.Black;switch(t.getParam("button_style")){case"white":n=YaPay.ButtonTheme.White;break;case"border":n=YaPay.ButtonTheme.WhiteOutlined}var r=document.querySelector("#woo-yandex-pay-button-contanier");t.button=a.createButton({type:YaPay.ButtonType.Pay,theme:n,width:YaPay.ButtonWidth.Auto}),t.button.mount(r),t.button.on(YaPay.ButtonEventType.Click,function(){let t=!0;if(e("#billing_first_name,#billing_last_name,#billing_address_1,#billing_city,#billing_state,#billing_postcode,#billing_phone,#billing_email").each(function(){""===e(this).val()&&(t=!1)}),!t)return e("#place_order").click(),!1;a.checkout()}),a.on(YaPay.PaymentEventType.Process,function(o){e("#woo-yandex-pay-payment-data").val(JSON.stringify(o)),e("#woo-yandex-pay-order-id").val(t.getParam("order").id),console.log(o),e("#place_order").click(),a.complete(YaPay.CompleteReason.Success)}),a.on(YaPay.PaymentEventType.Error,function(e){console.log(e),console.log(YaPay.CompleteReason),console.log(YaPay.CompleteReason.Error),a.complete(YaPay.CompleteReason.Error)})}).catch(function(e){console.log(e)})}removeButton(){this.button.unmount(document.querySelector("#woo-yandex-pay-button-contanier")),this.button=null,e("#woo-yandex-pay-payment-data").remove(),e("#woo-yandex-pay-order-id").remove()}refreshButton(){var t=this;e("#payment_method_yandex-pay").is(":checked")?this.loadSdk().then(function(){t.button&&t.removeButton(),t.createButton()}):t.button&&(t.removeButton(),e("#place_order").is(":visible")||e("#place_order").show())}getParam(e){return void 0!==window.yandex_pay_params?window.yandex_pay_params[e]||null:(new Error("Yandex pay params is not defined!"),{})}}});